<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JS Code and SVG Editor</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/editor/editor.main.css">
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      overflow: hidden; /* Prevents the page from scrolling */
    }

    #editorContainer {

      width: 50%; /* Initial width */
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #ccc;
      height: 100%; 
    }

    #sidebar {
      width: 50px;
      background-color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
      color: white;
    }

    
    #sidebar {
      width: 50px;
      background-color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
      color: white;
      font-family: Arial, sans-serif;
    }
    
    .icon-button {
      cursor: pointer;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      text-align: center;
      transition: color 0.3s, transform 0.3s;
    }

    .icon-button:hover {
      color: #1e90ff; 
      transform: scale(1.1); 
    }
    
    .icon-button .icon {
      font-size: 18px; 
      margin-bottom: 3px;
    }

    #editor {
      height: 100%;
    }    

    #svgEditor {
      width: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* Change the cursor to a resize icon on hover */
    #resizer:hover {
      background-color: #555;
    }

    #resizer {
      width: 6px;
      cursor: col-resize;
      background-color: #333;
      position: relative;
      z-index: 1;
      flex-shrink: 0;
      display: flex; /* Center the indicator */
      align-items: center;
      justify-content: center;
    }    

    #resizer::before {
      content: '';
      width: 4px; /* Width of the rectangle indicator */
      height: 100px; /* Height of the rectangle indicator */
      background-color: #777; /* Lighter color for visibility */
      border-radius: 2px; /* Optional: rounded corners */
    }    



    #shareDialog {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      border: 1px solid #ccc;
      padding: 20px;
      z-index: 1000;
    }
    #shareDialog input {
      width: 100%;
      box-sizing: border-box;
    }
    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }
  </style>
  <script src="resizer.js"></script>
</head>
<body>
  <div id="sidebar">
    <div id="share-btn" class="icon-button">
      <div class="icon">ðŸ”—</div>
      <div>Share</div>
    </div>
  </div>
  <div id="editorContainer">
    <div id="editor"></div>
  </div>
  <div id="resizer"></div>
  <div id="svgEditor"></div>

  <div id="overlay" onclick="closeShareDialog()"></div>
  <div id="shareDialog">
    <h3>Shareable Link</h3>
    <input type="text" id="shareLink" readonly>
    <button class="close">Close</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>
  
  <script>

    // Save the editor content to localStorage
    function saveToLocalStorage(content) {
      localStorage.setItem('svgContent', content);
    }

    // Retrieve content from localStorage
    function loadFromLocalStorage() {
      return localStorage.getItem('svgContent') || [
        '<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">',
        '  <rect width="100" height="100" style="fill:blue" />',
        '</svg>'
      ].join('\n');
    }



    let editor;

    require.config({ paths: { 
      'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs',
      'pako': 'https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min'
    } });

    require(['vs/editor/editor.main', 'pako'], function (monaco, pako) {
      // Move the editor setup code inside this function to ensure 'pako' is loaded
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: loadFromLocalStorage(),
        language: 'xml',
        theme: 'vs-dark',
      });

      // Listen for changes in the editor and update the SVG editor
      editor.onDidChangeModelContent(function () {
        var svgCode = editor.getValue();
        document.getElementById('svgEditor').innerHTML = svgCode;

        saveToLocalStorage(svgCode); // Save to localStorage

      });

      // Initial render of the SVG from editor content
      document.getElementById('svgEditor').innerHTML = editor.getValue();
    
      // Function to resize the Monaco Editor properly
      function resizeMonacoEditor() {
        editor.layout(); // Recalculate the editor layout based on the container's new size
      }


      // Trigger the initial resize of the Monaco Editor on load
      resizeMonacoEditor();
      
      // Optionally, handle window resize as well
      window.addEventListener('resize', resizeMonacoEditor);      
      window.addEventListener('resizer-update', resizeMonacoEditor);


    // Compression and decompression functions
    function compressAndEncodeToBase64(inputString) {
      const compressed = pako.deflate(inputString, { to: 'string' });
      let binaryString = '';
      for (let i = 0; i < compressed.length; i++) {
        binaryString += String.fromCharCode(compressed[i]);
      }
      return btoa(binaryString);
    }

    function decompressFromBase64(base64String) {
      const binaryString = atob(base64String);
      const byteArray = new Uint8Array(binaryString.length);
      for (let i = 0; i < binaryString.length; i++) {
        byteArray[i] = binaryString.charCodeAt(i);
      }
      return pako.inflate(byteArray, { to: 'string' });
    }

    function showShareDialog() {
      const svgCode = editor.getValue();
      const compressedCode = compressAndEncodeToBase64(svgCode);
      const shareUrl = `${window.location.origin}${window.location.pathname}#${compressedCode}`;
      document.getElementById('shareLink').value = shareUrl;
      document.getElementById('shareDialog').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    function closeShareDialog() {
      document.getElementById('shareDialog').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    // Check if there is a hash in the URL and load it into the editor
    window.onload = function () {
      const hash = window.location.hash.substr(1);
      if (hash) {
        try {
          const decodedCode = decompressFromBase64(hash);
          editor.setValue(decodedCode);
          document.getElementById('svgContainer').innerHTML = decodedCode;
        } catch (error) {
          alert("Failed to load SVG from the URL. The data may be corrupted.");
        }
      }

      document.getElementById('share-btn').addEventListener( 'click', e => {
         showShareDialog();
      });
      document.getElementById('overlay').addEventListener( 'click', e => {
        closeShareDialog();
      });      
      [...document.getElementById('shareDialog').getElementsByClassName('close')]
      .forEach( el => el.addEventListener( 'click', e => {
        closeShareDialog();
      }));      


      
    };
  });
  </script>
</body>
</html>
